<!DOCTYPE html>
<html layout:decorate="~{base}" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:th="http://www.thymeleaf.org">
<div class="card card-primary" layout:fragment="content-body">
	<div class="card-header">
		<h3 class="card-title">Fill in the form below</h3>
	</div>
	<div class="card-body">
		<form role="form" id="form">
			<div class="form-group">
				<label for="nik">NIK</label> <input type="text" class="form-control"
					id="nik" placeholder="Enter NIK">
			</div>
			<div class="form-group">
				<label for="nama">Name</label> <input type="text"
					class="form-control" id="name" placeholder="Enter Name">
			</div>
			<div class="form-group">
				<label for="address">Address</label> <input type="text"
					class="form-control" id="address" placeholder="Enter Address">
			</div>
			<div class="form-group">
				<label for="mobile">Mobile</label> <input type="text"
					class="form-control" id="mobile" placeholder="Enter Mobile">
			</div>
			<div class="form-group">
				<label for="birthdate">Birthdate</label> <input type="date"
					class="form-control" id="birthdate" placeholder="Enter Birthdate">
			</div>
			<div class="form-group">
				<label for="birthplace">Birthplace</label> <input type="text"
					class="form-control" id="birthplace" placeholder="Enter Birthplace">
			</div>
		</form>
		<div class="card-footer">
			<button type="submit" id="btn" class="btn btn-primary">Submit</button>
		</div>
		<div class="card-body table-responsive">
                <table class="table table-striped table-bordered table-hover nowrap" id="tableBiodata"
                       style="width:100%"></table>
        </div>
		<div class="card-footer">
			<button type="submit" id="reset" class="btn btn-primary">Reset</button>
		</div>
	</div>
	
	<th:block layout:fragment="add-scripts">
		<!-- jQuery -->
		<script th:src="@{/plugins/jquery/jquery.min.js}"></script>
		<script th:src="@{/js/default.js}"></script>
		<script th:src="@{/js/biodata.js}"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/parsley.js/2.9.1/parsley.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script th:src="@{/plugins/bootstrap/js/bootstrap.bundle.min.js}"></script>
		<!-- DataTables -->
		<script th:src="@{/plugins/datatables/jquery.dataTables.js}"></script>
		<script th:src="@{/plugins/datatables-bs4/js/dataTables.bootstrap4.js}"></script>
		<!-- Sweetalert -->
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
		<script src="sweetalert2.all.min.js"></script>
		<!-- Optional: include a polyfill for ES6 Promises for IE11 -->
		<script src="https://cdn.jsdelivr.net/npm/promise-polyfill"></script>
		<!-- AdminLTE -->
		<script th:src="@{/dist/js/adminlte.js}"></script>
		<script>
			$(document).ready(function() {
				$('#btn').click(function() {
					var $nik = $('#nik');
					var $name = $('#name');
					var $address = $('#address');
					var $mobile = $('#mobile');
					var $birthdate = $('#birthdate');
					var $birthplace = $('#birthplace');

					var datadto = {
						nik : $nik.val(),
						name : $name.val(),
						address : $address.val(),
						hp : $mobile.val(),
						tgl : $birthdate.val(),
						tempatLahir : $birthplace.val()
					};
					
					var dob = $birthdate.val();
					dob = new Date(dob);
					var today = new Date();
					var age = Math.floor((today-dob)/(365.25 * 24 * 60 * 60 * 1000))

					$.ajax({
						url : '/biodata',
						method : 'post',
						contentType : 'application/json',
						dataType : 'json',
						data : JSON.stringify(datadto),
						success : function() {
							if ($nik.val().length!=16 && age>=30)
								Swal.fire({
									  icon: 'error',
									  title: 'Oops...',
									  text: 'Jumlah NIK tidak sama dengan 16!'
									})
							else if ($nik.val().length==16 && age<30)
								Swal.fire({
									  icon: 'error',
									  title: 'Oops...',
									  text: 'Umur kurang dari 30 tahun'
									})
							else if ($nik.val().length!=16 && age<30)
								Swal.fire({
									  icon: 'error',
									  title: 'Oops...',
									  text: 'Jumlah NIK tidak sama dengan 16 dan umur kurang dari 30 tahun'
									})
							else
								Swal.fire({
									  position: 'top-end',
									  icon: 'success',
									  title: 'Data berhasil disimpan',
									  showConfirmButton: false,
									  timer: 1500
									})
						},
						error : function() {
							alert('failed');
						}
					});
				});
			});
		</script>
	</th:block>
</div>
</html>